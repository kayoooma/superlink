<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Комил Султонов — все ссылки</title>
  <meta name="description" content="Link‑in‑bio: все мои соцсети, проекты, курсы и контакты в одном месте." />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0b0f">
  
  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Комил Султонов — все ссылки" />
  <meta property="og:description" content="Мои соцсети, проекты, курсы и контакты в одном месте." />
  <meta property="og:image" content="preview.jpg" />
  <meta property="og:url" content="https://example.com" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui", "Apple Color Emoji", "Segoe UI Emoji"] },
          boxShadow: {
            'glow': '0 0 0 2px rgba(255,255,255,0.06), 0 10px 30px rgba(0,0,0,0.35)',
            'lift': '0 12px 30px rgba(0,0,0,0.22)'
          },
          colors: {
            brand: {
              50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa',
              500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95'
            }
          }
        }
      },
      darkMode: 'class'
    }
  </script>

  <style>
    /* THEME COLORS (editable via pills) */
    :root { --grad-1:#0ea5e9; --grad-2:#8b5cf6; --grad-3:#f43f5e; }

    /* BACKGROUNDS (switchable) */
    .bg-layer{position:fixed;inset:-20vmax;z-index:-1;pointer-events:none}

    /* 1) Blobs (Juice) */
    .bg-juice{filter:blur(60px);opacity:.55;animation:float 22s ease-in-out infinite alternate;
      background:radial-gradient(40vmax 40vmax at 15% 15%,var(--grad-1),transparent 60%),
                 radial-gradient(35vmax 35vmax at 85% 20%,var(--grad-2),transparent 60%),
                 radial-gradient(45vmax 45vmax at 50% 85%,var(--grad-3),transparent 60%)}
    @keyframes float{0%{transform:translate3d(0,0,0) scale(1)}100%{transform:translate3d(0,-3%,0) scale(1.03)}}

    /* 2) Mesh */
    .bg-mesh{opacity:.7;filter:blur(40px);
      background: radial-gradient(30vmax 30vmax at 20% 20%, var(--grad-1), transparent 60%),
                  radial-gradient(30vmax 30vmax at 80% 30%, var(--grad-2), transparent 60%),
                  radial-gradient(30vmax 30vmax at 40% 80%, var(--grad-3), transparent 60%)}

    /* 3) Aurora */
    .bg-aurora{opacity:.6;filter:blur(64px);
      background: conic-gradient(from 0deg at 70% 30%, var(--grad-2), transparent 40%),
                  conic-gradient(from 180deg at 30% 70%, var(--grad-1), transparent 40%),
                  radial-gradient(40vmax 30vmax at 50% 50%, var(--grad-3), transparent 60%);
      animation: aur 18s ease-in-out infinite alternate}
    @keyframes aur{to{transform:translate3d(0,-2%,0) rotate(.5deg)}}

    /* 4) Silver (brushed metal) */
    .bg-silver{inset:0;opacity:.9;filter:contrast(105%);
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.14) 0 2px, rgba(255,255,255,0) 2px 8px),
        linear-gradient(135deg,#cfd4da 0%,#f7f9fb 35%,#c3c7cd 50%,#eef1f5 65%,#cfd4da 100%);
      animation: brush 24s linear infinite}
    @keyframes brush{to{background-position:400px 0, 0 0}}

    /* 5) Chrome (high‑contrast metal) */
    .bg-chrome{inset:0;opacity:.95;
      background:
        linear-gradient(135deg,#0b0b0f 0%,#1e2127 20%,#dfe3e8 50%,#1f2228 80%,#0b0b0f 100%);
      background-size:160% 160%;
      animation: chromeShift 20s ease-in-out infinite alternate}
    @keyframes chromeShift{to{background-position:100% 0}}

    /* 6) Champagne (warm gold) */
    .bg-champagne{inset:0;opacity:.9;filter:saturate(105%);
      background:
        radial-gradient(60vmax 30vmax at 70% 20%, rgba(255,255,255,.35), transparent 60%),
        linear-gradient(135deg,#f6e7c1 0%,#fff6dc 30%,#ead9b5 55%,#f8edd0 75%,#e7d2a9 100%)}

    /* 7) Stars (Y2K) — separate overlay toggle */
    .bg-stars{position:fixed;inset:0;pointer-events:none;opacity:.9;display:none}
    .star{position:absolute;left:0;top:0;will-change:transform;filter:drop-shadow(0 0 6px rgba(255,255,255,.25))}

    /* Visibility toggling for backgrounds */
    [data-bg] .bg-layer{display:none}
    [data-bg="juice"] .bg-juice{display:block}
    [data-bg="mesh"] .bg-mesh{display:block}
    [data-bg="aurora"] .bg-aurora{display:block}
    [data-bg="silver"] .bg-silver{display:block}
    [data-bg="chrome"] .bg-chrome{display:block}
    [data-bg="champagne"] .bg-champagne{display:block}

    /* Stars toggle */
    [data-stars="on"] .bg-stars{display:block}

    /* Button ripple */
    .ripple{position:relative;overflow:hidden}
    .ripple:after{content:"";position:absolute;inset:0;border-radius:9999px;opacity:0;transform:scale(.2);background:currentColor;mix-blend-mode:soft-light;transition:transform .45s ease, opacity .45s ease}
    .ripple:active:after{opacity:.2;transform:scale(1.15)}

    /* SURFACES */
    .surface{transition:transform .15s ease, box-shadow .2s ease}
    .surface:hover{transform:translateY(1px)}
    .surface:active{transform:translateY(2px)}
    .glass{backdrop-filter:blur(10px);background:rgba(255,255,255,.7)}
    .dark .glass{background:rgba(9,9,12,.6)}
    .solid{background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.9)); border:1px solid rgba(0,0,0,.05)}
    .dark .solid{background:linear-gradient(180deg, rgba(20,20,25,.9), rgba(20,20,25,.85)); border:1px solid rgba(255,255,255,.06)}

    /* Focus ring */
    .focus-ring:focus-visible{outline:2px solid rgba(139,92,246,.7);outline-offset:3px;border-radius:14px}

    /* Dialog */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:1rem}
    .modal.show{display:flex}

    /* Tabs + language/stars pills */
    .tab-btn,.lang-pill,.stars-pill{font-size:12px;border-radius:10px;border:1px solid rgba(255,255,255,.35);padding:4px 8px}
    .dark .tab-btn,.dark .lang-pill,.dark .stars-pill{border-color:rgba(255,255,255,.15)}
    .tab-btn.active,.lang-pill.active,.stars-pill.active{background:rgba(255,255,255,.9)}
    .dark .tab-btn.active,.dark .lang-pill.active,.dark .stars-pill.active{background:rgba(255,255,255,.1)}

    /* Toast */
    #toast{transition:opacity .2s ease, transform .2s ease}
  </style>
</head>
<body data-bg="juice" data-stars="off" class="min-h-screen bg-[radial-gradient(1200px_600px_at_50%_-10%,rgba(139,92,246,.15),transparent),linear-gradient(180deg,#0b0b0f,#0b0b0f)] text-slate-900 dark:text-slate-100">
  <!-- Background layers -->
  <div class="bg-layer bg-juice"></div>
  <div class="bg-layer bg-mesh"></div>
  <div class="bg-layer bg-aurora"></div>
  <div class="bg-layer bg-silver"></div>
  <div class="bg-layer bg-chrome"></div>
  <div class="bg-layer bg-champagne"></div>
  <div class="bg-layer bg-stars"></div>

  <!-- Page container -->
  <main class="relative mx-auto max-w-xl px-4 sm:px-6 pt-10 pb-28">
    <!-- Announcement bar -->
    <div class="mb-6">
      <div class="surface glass shadow-glow border border-white/10 dark:border-white/5 rounded-2xl px-4 py-2 text-sm flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="inline-flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
          <span class="font-medium" data-i18n="announce">Открыт к проектам и коллабам</span>
        </div>
        <a href="#links" class="text-brand-400 hover:text-brand-300 font-semibold" data-i18n="seeLinks">Смотреть ссылки →</a>
      </div>
    </div>

    <!-- Header card -->
    <section class="surface glass shadow-glow border border-white/10 dark:border-white/5 rounded-3xl p-6 sm:p-8">
      <div class="flex items-center gap-5">
        <!-- Avatar (replace src with your photo) -->
        <div class="relative">
          <img id="avatar" src="avatar.jpg" alt="Аватар Комила Султонова" class="h-20 w-20 sm:h-24 sm:w-24 rounded-2xl object-cover ring-4 ring-white/40 dark:ring-white/10" onerror="this.style.display='none';document.getElementById('avatar-fallback').style.display='grid'"/>
          <div id="avatar-fallback" class="hidden place-items-center h-20 w-20 sm:h-24 sm:w-24 rounded-2xl bg-gradient-to-br from-brand-500 to-rose-500 text-white text-3xl font-extrabold select-none">KS</div>
        </div>
        <div class="min-w-0">
          <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Комил Султонов</h1>
          <p class="text-sm sm:text-base text-slate-600 dark:text-slate-400 truncate">MarTech / Project Manager • Telegram‑боты • AI‑решения • Сайты</p>
          <div class="mt-3 flex flex-wrap gap-2">
            <span class="px-2.5 py-1 text-xs rounded-full bg-white/70 dark:bg-white/10 border border-white/40 dark:border-white/10" data-i18n="badgeExp">7+ лет опыта</span>
            <span class="px-2.5 py-1 text-xs rounded-full bg-white/70 dark:bg-white/10 border border-white/40 dark:border-white/10" data-i18n="badgeResp">Ответ за ~1 час</span>
            <span class="px-2.5 py-1 text-xs rounded-full bg-white/70 dark:bg-white/10 border border-white/40 dark:border-white/10">UZ/RU/EN</span>
          </div>
        </div>
      </div>

      <!-- Quick actions -->
      <div class="mt-6 grid grid-cols-2 gap-3">
        <a id="btnCall" href="tel:+998881116612" class="ripple focus-ring flex items-center justify-center gap-2 rounded-2xl px-3 py-3 bg-white/80 dark:bg-white/10 border border-white/40 dark:border-white/10 hover:translate-y-[1px] active:translate-y-[2px] transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a1.5 1.5 0 0 0 1.5-1.5v-2.1a1.5 1.5 0 0 0-1.2-1.47l-3.3-.66a1.5 1.5 0 0 0-1.53.6l-.9 1.2a12.3 12.3 0 0 1-5.7-5.7l1.2-.9a1.5 1.5 0 0 0 .6-1.53l-.66-3.3A1.5 1.5 0 0 0 8.85 3H6.75A1.5 1.5 0 0 0 5.25 4.5v2.25Z"/></svg>
          <span class="text-sm font-semibold" data-i18n="call">Позвонить</span>
        </a>
        <a id="btnEmail" href="mailto:kamasultanov8@gmail.com" class="ripple focus-ring flex items-center justify-center gap-2 rounded-2xl px-3 py-3 bg-white/80 dark:bg-white/10 border border-white/40 dark:border-white/10 hover:translate-y-[1px] active:translate-y-[2px] transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m3 7 9 6 9-6m-18 10h18V7H3v10Z"/></svg>
          <span class="text-sm font-semibold" data-i18n="email">Email</span>
        </a>
      </div>

      <!-- Theme, background & style controls -->
      <div class="mt-6 flex flex-wrap items-center gap-3">
        <button id="darkToggle" class="ripple focus-ring inline-flex items-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold bg-white/80 dark:bg-white/10 border border-white/40 dark:border-white/10">
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 hidden dark:block" viewBox="0 0 24 24" fill="currentColor"><path d="M21.75 15.5A9.75 9.75 0 0 1 8.5 2.25c.24 0 .48.01.71.03a.75.75 0 0 1 .39 1.35A8.25 8.25 0 1 0 20.37 14.4a.75.75 0 0 1 1.35.39c.02.24.03.48.03.71Z"/></svg>
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 dark:hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5V2.25m0 19.5V19.5M4.5 12H2.25m19.5 0H19.5M5.47 5.47 3.89 3.89m16.22 16.22-1.58-1.58M18.53 5.47l1.58-1.58M5.47 18.53l-1.58 1.58M12 7.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9Z"/></svg>
          <span data-i18n="theme">Тема</span>
        </button>
        <div class="flex items-center gap-2 text-xs">
          <span class="opacity-70" data-i18n="color">Цвет:</span>
          <div class="flex items-center gap-1.5">
            <button class="theme-pill h-6 w-6 rounded-full border border-white/50" style="--c1:#0ea5e9;--c2:#8b5cf6;--c3:#f43f5e; background: linear-gradient(135deg,var(--c1),var(--c2),var(--c3));" aria-label="Фиолетово-розовый"></button>
            <button class="theme-pill h-6 w-6 rounded-full border border-white/50" style="--c1:#22c55e;--c2:#eab308;--c3:#f97316; background: linear-gradient(135deg,var(--c1),var(--c2),var(--c3));" aria-label="Тёплый"></button>
            <button class="theme-pill h-6 w-6 rounded-full border border-white/50" style="--c1:#06b6d4;--c2:#14b8a6;--c3:#84cc16; background: linear-gradient(135deg,var(--c1),var(--c2),var(--c3));" aria-label="Бирюзовый"></button>
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span class="opacity-70" data-i18n="bg">Фон:</span>
          <div class="flex items-center gap-1.5">
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="juice" title="Blobs" style="background:radial-gradient(circle at 30% 30%,#a78bfa,transparent 40%), radial-gradient(circle at 70% 30%,#0ea5e9,transparent 40%), radial-gradient(circle at 50% 80%,#f43f5e,transparent 40%)"></button>
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="mesh" title="Mesh" style="background:linear-gradient(135deg,#a78bfa,#0ea5e9,#f43f5e)"></button>
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="aurora" title="Aurora" style="background:conic-gradient(from 0deg,#8b5cf6,#0ea5e9,#f43f5e)"></button>
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="silver" title="Silver" style="background:linear-gradient(135deg,#cfd4da,#f7f9fb,#c3c7cd)"></button>
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="chrome" title="Chrome" style="background:linear-gradient(135deg,#0b0b0f,#dfe3e8,#0b0b0f)"></button>
            <button class="bg-pill h-6 w-6 rounded-full border border-white/50" data-bg="champagne" title="Champagne" style="background:linear-gradient(135deg,#f6e7c1,#fff6dc,#ead9b5)"></button>
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span class="opacity-70" data-i18n="style">Стиль:</span>
          <div class="flex items-center gap-1.5">
            <button id="styleGlass" class="style-pill px-2 py-1 rounded-md border border-white/40 text-[11px]" data-i18n="styleGlass">Glass</button>
            <button id="styleSolid" class="style-pill px-2 py-1 rounded-md border border-white/40 text-[11px]" data-i18n="styleSolid">Solid</button>
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span class="opacity-70" data-i18n="langLabel">Язык:</span>
          <div class="flex items-center gap-1.5">
            <button id="langRU" class="lang-pill active">RU</button>
            <button id="langEN" class="lang-pill">EN</button>
          </div>
        </div>
        <div class="flex items-center gap-2 text-xs">
          <span class="opacity-70" data-i18n="starsLabel">Звёзды:</span>
          <div class="flex items-center gap-1.5">
            <button id="starsOff" class="stars-pill">Off</button>
            <button id="starsOn" class="stars-pill">On</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Links -->
    <section id="links" class="mt-6 space-y-3">
      <a href="https://t.me/Ka_yooo_ma" target="_blank" rel="noreferrer" class="surface link-card ripple focus-ring group flex items-center gap-3 rounded-2xl px-5 py-4 glass border border-white/10 transition">
        <span class="flex h-9 w-9 items-center justify-center rounded-xl bg-[#229ED9]/15 text-[#229ED9]">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor"><path d="M21.944 5.76c.24-1.114-.85-2.03-1.89-1.6L3.4 11.1c-1.042.43-.97 1.95.105 2.26l4.46 1.3 1.74 5.4c.29.91 1.48 1.11 2.06.34l2.47-3.21 4.71 3.43c.86.63 2.09.16 2.31-.88L21.94 5.76Zm-4.5 2.6-8.64 7.53-.37 3.17 1.14-2.52 7.87-8.18Z"/></svg>
        </span>
        <div class="grow">
          <div class="flex items-center justify-between gap-3">
            <h3 class="text-base font-semibold">Telegram</h3>
            <span class="text-xs text-slate-500 dark:text-slate-400 group-hover:opacity-100 opacity-70" data-i18n="telegramWrite">Написать →</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400" data-i18n="tgDesc">Быстрее всего отвечаю здесь</p>
        </div>
      </a>

      <a href="https://www.instagram.com/ka_yoooo_ma?igsh=M24xdWtzOGZmZm96" target="_blank" rel="noreferrer" class="surface link-card ripple focus-ring group flex items-center gap-3 rounded-2xl px-5 py-4 glass border border-white/10 transition">
        <span class="flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-pink-500 to-yellow-500 text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 3 0 0 0-3-3H7Zm5 3.5a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9Zm0 2a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5Zm5.25-.75a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>
        </span>
        <div class="grow">
          <div class="flex items-center justify-between gap-3">
            <h3 class="text-base font-semibold">Instagram</h3>
            <span class="text-xs text-slate-500 dark:text-slate-400" data-i18n="instLabel">Лента, сторис</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400" data-i18n="instDesc">Кейсы и закулисье моих проектов</p>
        </div>
      </a>

      <a href="https://kayoooma.github.io/project_manager/en/" target="_blank" rel="noreferrer" class="surface link-card ripple focus-ring group flex items-center gap-3 rounded-2xl px-5 py-4 glass border border-white/10 transition">
        <span class="flex h-9 w-9 items-center justify-center rounded-xl bg-brand-500/20 text-brand-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5"/></svg>
        </span>
        <div class="grow">
          <div class="flex items-center justify-between gap-3">
            <h3 class="text-base font-semibold" data-i18n="website">Сайт</h3>
            <span class="text-xs text-slate-500 dark:text-slate-400" data-i18n="websiteLabel">Сайт →</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400" data-i18n="websiteDesc">Мой сайт и проекты</p>
        </div>
      </a>

      <button id="openBook" class="surface link-card ripple focus-ring group w-full flex items-center gap-3 rounded-2xl px-5 py-4 glass border border-white/10 transition text-left">
        <span class="flex h-9 w-9 items-center justify-center rounded-xl bg-indigo-500/20 text-indigo-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.75 3v3m10.5-3v3M3.75 8.25h16.5M5.25 21h13.5A1.5 1.5 0 0 0 20.25 19.5V7.5A1.5 1.5 0 0 0 18.75 6H5.25A1.5 1.5 0 0 0 3.75 7.5v12A1.5 1.5 0 0 0 5.25 21Z"/></svg>
        </span>
        <div class="grow">
          <div class="flex items-center justify-between gap-3">
            <h3 class="text-base font-semibold" data-i18n="bookBtn">Записаться на звонок</h3>
            <span class="text-xs text-slate-500 dark:text-slate-400" data-i18n="bookVia">через Cal.com</span>
          </div>
          <p class="text-sm text-slate-600 dark:text-slate-400" data-i18n="bookDesc">Выберите слот или оставьте быструю заявку</p>
        </div>
      </button>
    </section>

    <!-- Footer -->
    <footer class="mt-8 flex flex-col items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
      <p>© <span id="year"></span> Комил Султонов • <a class="underline" href="https://t.me/Ka_yooo_ma" target="_blank" rel="noreferrer">@Ka_yooo_ma</a></p>
    </footer>
  </main>

  <!-- Booking Modal (Cal.com + Quick form tabs) -->
  <div id="bookModal" class="modal">
    <div class="surface glass shadow-glow rounded-2xl border border-white/10 dark:border-white/5 max-w-2xl w-full p-4 sm:p-5 relative">
      <button id="closeBook" class="absolute right-3 top-3 opacity-70 hover:opacity-100" aria-label="Закрыть">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811 4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811Z"/></svg>
      </button>

      <div class="flex items-center justify-between gap-3 pr-6">
        <h3 class="text-lg font-semibold" data-i18n="modalTitle">Запись на звонок</h3>
        <div class="inline-flex gap-2">
          <button id="tabCal" class="tab-btn active">Cal.com</button>
          <button id="tabQuick" class="tab-btn" data-i18n="tabsQuick">Быстрая заявка</button>
        </div>
      </div>
      <p class="text-xs text-slate-600 dark:text-slate-400 mt-1" data-i18n="modalLead">Выберите удобный слот или оставьте заявку с желаемым временем.</p>

      <!-- Cal.com pane -->
      <div id="calPane" class="mt-3">
        <iframe id="calFrame" title="Cal.com" class="w-full h-[72vh] rounded-xl border border-white/10 dark:border-white/5 bg-white/90 dark:bg-white/5" src="about:blank" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div class="mt-2 text-xs text-slate-500"><span data-i18n="notLoading">Не грузится?</span> <a id="openCalNewTab" class="underline" href="#" target="_blank" rel="noreferrer" data-i18n="openCal">Открыть на cal.com</a></div>
      </div>

      <!-- Quick form pane -->
      <div id="quickPane" class="hidden">
        <form id="bookForm" class="mt-4 space-y-3">
          <div>
            <label class="text-xs opacity-80" data-i18n="formNameLabel">Ваше имя</label>
            <input type="text" id="bfName" class="mt-1 w-full rounded-xl border border-white/20 bg-white/90 dark:bg-white/10 px-3 py-2 focus:outline-none" placeholder="Например, Азиз" required />
          </div>
          <div>
            <label class="text-xs opacity-80" data-i18n="formDateLabel">Дата и время (UTC+5)</label>
            <input type="datetime-local" id="bfDT" class="mt-1 w-full rounded-xl border border-white/20 bg-white/90 dark:bg-white/10 px-3 py-2 focus:outline-none" required />
          </div>
          <div>
            <label class="text-xs opacity-80" data-i18n="formMethodLabel">Способ связи</label>
            <div class="mt-1 grid grid-cols-2 gap-2 text-sm">
              <label class="flex items-center gap-2 rounded-xl border border-white/20 bg-white/80 dark:bg-white/10 px-3 py-2 cursor-pointer"><input type="radio" name="bfMethod" value="telegram" checked> Telegram</label>
              <label class="flex items-center gap-2 rounded-xl border border-white/20 bg-white/80 dark:bg-white/10 px-3 py-2 cursor-pointer"><input type="radio" name="bfMethod" value="email"> Email</label>
              <label class="flex items-center gap-2 rounded-xl border border-white/20 bg-white/80 dark:bg-white/10 px-3 py-2 cursor-pointer"><input type="radio" name="bfMethod" value="phone" data-i18n="phone"> Телефон</label>
            </div>
          </div>
          <div>
            <label class="text-xs opacity-80" data-i18n="formCommentLabel">Комментарий (опционально)</label>
            <textarea id="bfMsg" rows="3" class="mt-1 w-full rounded-xl border border-white/20 bg-white/90 dark:bg-white/10 px-3 py-2 focus:outline-none" placeholder="Опишите задачу"></textarea>
          </div>
          <div class="flex items-center justify-between gap-2 pt-1">
            <button type="button" id="bfCancel" class="ripple rounded-xl px-3 py-2 text-sm border border-white/30 bg-white/70 dark:bg-white/10" data-i18n="cancel">Отмена</button>
            <button type="submit" class="ripple rounded-xl px-4 py-2 text-sm font-semibold bg-brand-600 text-white hover:bg-brand-700" data-i18n="send">Отправить</button>
          </div>
          <p id="bfHint" class="hidden text-xs text-emerald-500" data-i18n="hintCopied">Заявка скопирована — откроется чат, просто вставьте и отправьте.</p>
        </form>
      </div>
    </div>
  </div>

  <!-- Contact (copy) modal -->
  <div id="contactModal" class="modal">
    <div class="surface glass shadow-glow rounded-2xl border border-white/10 dark:border-white/5 max-w-md w-full p-4 sm:p-5 relative">
      <button id="closeContact" class="absolute right-3 top-3 opacity-70 hover:opacity-100" aria-label="Закрыть">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6.225 4.811 4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586 6.225 4.811Z"/></svg>
      </button>
      <h3 id="contactTitle" class="text-lg font-semibold mb-2">Контакты</h3>
      <div class="flex items-center gap-2">
        <code id="contactValue" class="px-2 py-1 rounded-md bg-white/80 dark:bg-white/10 border border-white/30 text-sm select-all">—</code>
        <button id="copyContact" class="ripple rounded-md border border-white/30 bg-white/80 dark:bg-white/10 px-2 py-1 text-sm">Скопировать</button>
      </div>
      <div class="mt-3 flex items-center justify-end gap-2">
        <button id="openContact" class="ripple rounded-md px-3 py-2 text-sm font-semibold bg-brand-600 text-white hover:bg-brand-700">Открыть</button>
        <button id="cancelContact" class="ripple rounded-md px-3 py-2 text-sm border border-white/30 bg-white/70 dark:bg-white/10">Закрыть</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-6 z-50 hidden">
    <div class="surface solid rounded-xl shadow-glow px-4 py-2 text-sm border border-white/20">
      <span id="toastText">Готово</span>
    </div>
  </div>

  <script>
    // --- Persistent dark mode
    const root = document.documentElement;
    const body = document.body;
    const darkToggle = document.getElementById('darkToggle');
    const storedTheme = localStorage.getItem('theme');
    if (storedTheme === 'dark' || (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      root.classList.add('dark');
    }
    darkToggle.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
      // recolor stars if enabled
      if (starsEnabled) initStars(true);
    });

    // --- i18n
    const t = {
      ru: {
        title: 'Комил Султонов — все ссылки',
        announce: 'Открыт к проектам и коллабам',
        seeLinks: 'Смотреть ссылки →',
        call: 'Позвонить', email: 'Email', theme: 'Тема', color: 'Цвет:', bg: 'Фон:', style: 'Стиль:', styleGlass: 'Glass', styleSolid: 'Solid', langLabel: 'Язык:',
        telegramWrite: 'Написать →', tgDesc: 'Быстрее всего отвечаю здесь',
        instLabel: 'Лента, сторис', instDesc: 'Кейсы и закулисье моих проектов',
        website: 'Сайт', websiteLabel: 'Сайт →', websiteDesc: 'Мой сайт и проекты',
        bookBtn: 'Записаться на звонок', bookVia: 'через Cal.com', bookDesc: 'Выберите слот или оставьте быструю заявку',
        statsTitle: 'Клики (локально)', reset: 'сбросить',
        modalTitle: 'Запись на звонок', tabsQuick: 'Быстрая заявка', modalLead: 'Выберите удобный слот или оставьте заявку с желаемым временем.', notLoading: 'Не грузится?', openCal: 'Открыть на cal.com',
        formNameLabel: 'Ваше имя', formDateLabel: 'Дата и время (UTC+5)', formMethodLabel: 'Способ связи', formCommentLabel: 'Комментарий (опционально)', cancel: 'Отмена', send: 'Отправить', hintCopied: 'Заявка скопирована — откроется чат, просто вставьте и отправьте.',
        phone: 'Телефон',
        copy: 'Скопировать', copied: 'Скопировано', contactTitlePhone: 'Телефон', contactTitleEmail: 'Email', openMail: 'Открыть почту', startCall: 'Позвонить',
        starsLabel: 'Звёзды:', on: 'Вкл', off: 'Выкл'
      },
      en: {
        title: 'Komil Sultonov — links',
        announce: 'Open for projects & collabs',
        seeLinks: 'See links →',
        call: 'Call', email: 'Email', theme: 'Theme', color: 'Color:', bg: 'Background:', style: 'Style:', styleGlass: 'Glass', styleSolid: 'Solid', langLabel: 'Language:',
        telegramWrite: 'Message →', tgDesc: 'Fastest replies here',
        instLabel: 'Feed, stories', instDesc: 'Behind the scenes of my projects',
        website: 'Website', websiteLabel: 'Website →', websiteDesc: 'My site & projects',
        bookBtn: 'Book a call', bookVia: 'via Cal.com', bookDesc: 'Choose a slot or leave a quick request',
        statsTitle: 'Clicks (local)', reset: 'reset',
        modalTitle: 'Book a call', tabsQuick: 'Quick request', modalLead: 'Pick a slot or leave your preferred time.', notLoading: "Doesn't load?", openCal: 'Open on cal.com',
        formNameLabel: 'Your name', formDateLabel: 'Date & time (UTC+5)', formMethodLabel: 'Contact method', formCommentLabel: 'Comment (optional)', cancel: 'Cancel', send: 'Send', hintCopied: 'Request copied — opening chat, just paste and send.',
        phone: 'Phone',
        copy: 'Copy', copied: 'Copied', contactTitlePhone: 'Phone', contactTitleEmail: 'Email', openMail: 'Open Mail', startCall: 'Start call',
        starsLabel: 'Stars:', on: 'On', off: 'Off'
      }
    };

    function applyI18n(lang){
      const dict = t[lang] || t.ru;
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(dict[key]) el.textContent = dict[key];
      });
      // placeholders
      const nameInput = document.getElementById('bfName');
      const msgInput = document.getElementById('bfMsg');
      if(nameInput) nameInput.placeholder = lang==='en' ? 'e.g., Aziz' : 'Например, Азиз';
      if(msgInput) msgInput.placeholder = lang==='en' ? 'Describe your task' : 'Опишите задачу';
      document.title = dict.title;
      document.documentElement.lang = lang;
      localStorage.setItem('lang', lang);
      // toggle pill active
      document.getElementById('langRU').classList.toggle('active', lang==='ru');
      document.getElementById('langEN').classList.toggle('active', lang==='en');
      // stars pills text
      document.getElementById('starsOn').textContent = dict.on;
      document.getElementById('starsOff').textContent = dict.off;
    }

    let savedLang = localStorage.getItem('lang') || 'ru';
    applyI18n(savedLang);
    document.getElementById('langRU').addEventListener('click', ()=>{ savedLang='ru'; applyI18n('ru'); });
    document.getElementById('langEN').addEventListener('click', ()=>{ savedLang='en'; applyI18n('en'); });

    // --- Theme pills (colors)
    const setTheme = (c1, c2, c3) => {
      root.style.setProperty('--grad-1', c1);
      root.style.setProperty('--grad-2', c2);
      root.style.setProperty('--grad-3', c3);
      localStorage.setItem('juice', JSON.stringify([c1,c2,c3]));
    }
    const savedJuice = localStorage.getItem('juice');
    if (savedJuice) try { const [a,b,c] = JSON.parse(savedJuice); setTheme(a,b,c);} catch(e){}
    document.querySelectorAll('.theme-pill').forEach(btn => btn.addEventListener('click', () => {
      const s = getComputedStyle(btn);
      const g = s.backgroundImage.match(/rgb\([^)]+\)/g);
      if (g && g.length >= 3) setTheme(g[0], g[1], g[2]);
    }));

    // --- Background switcher (with legacy cleanup)
    let savedBG = localStorage.getItem('bgVariant') || 'juice';
    if (savedBG === 'grid' || savedBG === 'mono' || savedBG === 'stars') { savedBG = 'silver'; localStorage.setItem('bgVariant','silver'); }
    body.setAttribute('data-bg', savedBG);
    document.querySelectorAll('.bg-pill').forEach(b=>{
      b.addEventListener('click', ()=>{ body.setAttribute('data-bg', b.dataset.bg); localStorage.setItem('bgVariant', b.dataset.bg); });
    });

    // --- Card style switcher (glass/solid) — applies to ALL surfaces
    function applyStyle(style){
      document.querySelectorAll('.surface').forEach(el=>{
        el.classList.remove('glass','solid');
        el.classList.add(style);
      });
      localStorage.setItem('cardStyle', style);
    }
    const savedStyle = localStorage.getItem('cardStyle') || 'glass';
    applyStyle(savedStyle);
    document.getElementById('styleGlass').addEventListener('click', ()=>applyStyle('glass'));
    document.getElementById('styleSolid').addEventListener('click', ()=>applyStyle('solid'));

    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // --- Toast helper
    const toast = document.getElementById('toast');
    const toastText = document.getElementById('toastText');
    function showToast(msg){
      toastText.textContent = msg; toast.classList.remove('hidden'); toast.style.opacity = '1'; toast.style.transform = 'translate(-50%, 0)';
      setTimeout(()=>{ toast.style.opacity='0'; toast.style.transform='translate(-50%, 6px)'; setTimeout(()=>toast.classList.add('hidden'),200); }, 2500);
    }

    // --- Booking modal: tabs + Cal.com embed + Quick form
    const openBook = document.getElementById('openBook');
    const bookModal = document.getElementById('bookModal');
    const closeBook = document.getElementById('closeBook');
    const tabCal = document.getElementById('tabCal');
    const tabQuick = document.getElementById('tabQuick');
    const calPane = document.getElementById('calPane');
    const quickPane = document.getElementById('quickPane');
    const calFrame = document.getElementById('calFrame');
    const openCalNewTab = document.getElementById('openCalNewTab');
    const calUrl = 'https://cal.com/комил-султонов';
    const calUrlEnc = encodeURI(calUrl);
    openCalNewTab.href = calUrlEnc;

    function loadCal(){ if(!calFrame.src || calFrame.src==='about:blank'){ calFrame.src = calUrlEnc; } }
    function activateTab(which){
      if(which==='cal'){
        calPane.classList.remove('hidden'); quickPane.classList.add('hidden');
        tabCal.classList.add('active'); tabQuick.classList.remove('active');
        loadCal();
      } else {
        quickPane.classList.remove('hidden'); calPane.classList.add('hidden');
        tabQuick.classList.add('active'); tabCal.classList.remove('active');
      }
    }

    function showModal(){ bookModal.classList.add('show'); activateTab('cal'); }
    function hideModal(){ bookModal.classList.remove('show'); const f=document.getElementById('bookForm'); if(f) f.reset(); const hint=document.getElementById('bfHint'); if(hint) hint.classList.add('hidden'); }

    openBook.addEventListener('click', showModal);
    closeBook.addEventListener('click', hideModal);
    bookModal.addEventListener('click', (e)=>{ if(e.target===bookModal) hideModal(); });
    tabCal.addEventListener('click', ()=>activateTab('cal'));
    tabQuick.addEventListener('click', ()=>activateTab('quick'));

    // --- Quick form routing (Telegram / Email / Phone)
    const bfCancel = document.getElementById('bfCancel');
    const bfForm = document.getElementById('bookForm');
    const bfHint = document.getElementById('bfHint');
    bfCancel?.addEventListener('click', hideModal);
    bfForm?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const name = document.getElementById('bfName').value.trim();
      const dt = document.getElementById('bfDT').value; // yyyy-mm-ddThh:mm
      const method = (new FormData(bfForm)).get('bfMethod');
      const msg = document.getElementById('bfMsg').value.trim();
      const when = dt ? new Date(dt).toLocaleString(savedLang==='en' ? 'en-US' : 'ru-RU', { timeZone: 'Asia/Tashkent' }) : (savedLang==='en' ? 'no time selected' : 'время не указано');
      const text = (savedLang==='en') ?
        `Hi, Komil! I'd like to schedule a call.
Name: ${name}
Time (Tashkent): ${when}
Method: ${method}
Comment: ${msg || '—'}` :
        `Привет, Комил! Хочу созвониться.
Имя: ${name}
Время (Ташкент): ${when}
Способ: ${method}
Комментарий: ${msg || '—'}`;

      if(method === 'email'){
        const url = `mailto:kamasultanov8@gmail.com?subject=${encodeURIComponent(savedLang==='en' ? 'Call request' : 'Заявка на звонок')}&body=${encodeURIComponent(text)}`;
        window.location.href = url;
        showToast(savedLang==='en' ? 'Opened mail app with a draft' : 'Открыл почтовое приложение с письмом');
        hideModal();
      } else if(method === 'phone'){
        window.location.href = 'tel:+998881116612';
        showToast(savedLang==='en' ? 'Starting a call' : 'Запускаю звонок');
        hideModal();
      } else { // telegram
        navigator.clipboard?.writeText(text).then(()=>{ bfHint.classList.remove('hidden'); });
        window.open('https://t.me/Ka_yooo_ma', '_blank');
        showToast(savedLang==='en' ? 'Opened Telegram; request text copied' : 'Открыл Telegram; текст заявки скопирован');
      }
    });

    // --- Contact copy modal logic
    const contactModal = document.getElementById('contactModal');
    const contactTitle = document.getElementById('contactTitle');
    const contactValue = document.getElementById('contactValue');
    const copyContact = document.getElementById('copyContact');
    const openContact = document.getElementById('openContact');
    const closeContact = document.getElementById('closeContact');
    const cancelContact = document.getElementById('cancelContact');

    function showContact(type){
      const dict = t[savedLang];
      if(type==='phone'){
        contactTitle.textContent = dict.contactTitlePhone;
        contactValue.textContent = '+998881116612';
        openContact.textContent = dict.startCall;
        openContact.onclick = ()=>{ window.location.href = 'tel:+998881116612'; };
      } else {
        contactTitle.textContent = dict.contactTitleEmail;
        contactValue.textContent = 'kamasultanov8@gmail.com';
        openContact.textContent = dict.openMail;
        openContact.onclick = ()=>{ window.location.href = 'mailto:kamasultanov8@gmail.com'; };
      }
      copyContact.textContent = dict.copy;
      contactModal.classList.add('show');
    }
    function hideContact(){ contactModal.classList.remove('show'); }
    document.getElementById('btnCall').addEventListener('click', (e)=>{ e.preventDefault(); showContact('phone'); });
    document.getElementById('btnEmail').addEventListener('click', (e)=>{ e.preventDefault(); showContact('email'); });
    closeContact.addEventListener('click', hideContact);
    cancelContact.addEventListener('click', hideContact);
    contactModal.addEventListener('click', (e)=>{ if(e.target===contactModal) hideContact(); });
    copyContact.addEventListener('click', ()=>{
      const ok = navigator.clipboard && navigator.clipboard.writeText ? navigator.clipboard.writeText(contactValue.textContent) : (function(){
        const ta = document.createElement('textarea'); ta.value = contactValue.textContent; document.body.appendChild(ta); ta.select(); try{document.execCommand('copy');}catch(e){} document.body.removeChild(ta); return true; })();
      Promise.resolve(ok).then(()=>showToast(t[savedLang].copied + ': ' + contactValue.textContent));
    });

    // --- Stars overlay (toggle + physics, smooth, no scaling)
    const starLayer = document.querySelector('.bg-stars');
    const starsOnBtn = document.getElementById('starsOn');
    const starsOffBtn = document.getElementById('starsOff');
    let starsEnabled = (localStorage.getItem('stars')||'off') === 'on';

    // Physics & layout (no overlap ever)
    const PAD = 2;                 // extra gap in px between stars
    const SUBSTEPS = 6;            // more substeps = smoother and safer collisions
    const SPEED_MIN = 24;          // px/s
    const SPEED_MAX = 70;          // px/s
    const RESTITUTION = 0.96;      // near-elastic bounce, slightly damped to avoid jitter

    function starCount(){
      const area = Math.max(1, window.innerWidth * window.innerHeight);
      return Math.max(10, Math.min(24, Math.round(area / 60000)));
    }

    let stars = []; // {el,x,y,vx,vy,size,rot,omega}
    let rafId = null, lastT = 0;

    function starSVG(id, colorMain, colorEdge){
      return `<svg viewBox="0 0 100 100" width="100" height="100" aria-hidden="true">
        <defs>
          <radialGradient id="g${id}" cx="50%" cy="40%" r="65%">
            <stop offset="0%" stop-color="${colorMain}" stop-opacity="1"/>
            <stop offset="60%" stop-color="${colorMain}" stop-opacity=".85"/>
            <stop offset="100%" stop-color="${colorEdge}" stop-opacity="0"/>
          </radialGradient>
        </defs>
        <path fill="url(#g${id})" d="M50 0 L60 38 L100 50 L60 62 L50 100 L40 62 L0 50 L40 38 Z"/>
      </svg>`;
    }

    function randomNonOverlapPosition(size){
      const W = window.innerWidth, H = window.innerHeight; 
      const r = size/2 + PAD; // static size (no scaling)
      for(let tries=0; tries<500; tries++){
        const x = r + Math.random()*(W - 2*r);
        const y = r + Math.random()*(H - 2*r);
        let ok = true;
        for(const s of stars){
          const rr = s.size/2 + PAD;
          const dx=x-s.x, dy=y-s.y; 
          if(Math.hypot(dx,dy) < (r + rr)) { ok=false; break; }
        }
        if(ok) return {x,y};
      }
      return {x: Math.random()*W, y: Math.random()*H};
    }

    function spawnStars(){
      stars = []; starLayer.innerHTML = '';
      const isDark = root.classList.contains('dark');
      const colMain = isDark ? 'rgba(255,255,255,0.95)' : 'rgba(0,0,0,0.9)';
      const colEdge = 'transparent';
      const count = starCount();
      for(let i=0;i<count;i++){
        const size = 8 + Math.random()*10; // static sizes, just varied
        const {x,y} = randomNonOverlapPosition(size);
        const angle = Math.random()*Math.PI*2;
        const speed = SPEED_MIN + Math.random()*(SPEED_MAX - SPEED_MIN);
        const vx = Math.cos(angle)*speed;
        const vy = Math.sin(angle)*speed;
        const rot = Math.random()*360;         // gentle rotation
        const omega = (Math.random()*20 - 10); // deg/s (slow)
        const el = document.createElement('div'); el.className='star'; el.style.width=`${size}px`; el.style.height=`${size}px`;
        el.innerHTML = starSVG(i, colMain, colEdge);
        starLayer.appendChild(el);
        stars.push({el,x,y,vx,vy,size,rot,omega});
      }
    }

    function walls(s, W, H){
      const rad = s.size/2 + PAD;
      if(s.x < rad){ s.x = rad; s.vx = Math.abs(s.vx) * RESTITUTION; }
      if(s.x > W-rad){ s.x = W-rad; s.vx = -Math.abs(s.vx) * RESTITUTION; }
      if(s.y < rad){ s.y = rad; s.vy = Math.abs(s.vy) * RESTITUTION; }
      if(s.y > H-rad){ s.y = H-rad; s.vy = -Math.abs(s.vy) * RESTITUTION; }
    }

    function resolvePair(a,b){
      const ra = a.size/2 + PAD, rb = b.size/2 + PAD;
      const dx = b.x - a.x, dy = b.y - a.y;
      const dist = Math.hypot(dx,dy);
      const minDist = ra + rb;
      if(dist === 0) return;
      if(dist < minDist){
        const nx = dx/dist, ny = dy/dist; // normal a->b
        const overlap = (minDist - dist);
        // separate fully
        a.x -= nx*overlap*0.5; a.y -= ny*overlap*0.5;
        b.x += nx*overlap*0.5; b.y += ny*overlap*0.5;
        // relative normal velocity
        const rvx = b.vx - a.vx, rvy = b.vy - a.vy;
        const relNorm = rvx*nx + rvy*ny;
        if(relNorm < 0){
          const tx = -ny, ty = nx; // tangent
          const a_vn = a.vx*nx + a.vy*ny, a_vt = a.vx*tx + a.vy*ty;
          const b_vn = b.vx*nx + b.vy*ny, b_vt = b.vx*tx + b.vy*ty;
          const a_vn_new = b_vn * RESTITUTION;
          const b_vn_new = a_vn * RESTITUTION;
          a.vx = a_vn_new*nx + a_vt*tx;
          a.vy = a_vn_new*ny + a_vt*ty;
          b.vx = b_vn_new*nx + b_vt*tx;
          b.vy = b_vn_new*ny + b_vt*ty;
        }
      }
    }

    function step(ts){
      if(!rafId) return;
      if(!lastT) lastT = ts; let dt = (ts - lastT)/1000; lastT = ts;
      dt = Math.min(0.02, Math.max(0.008, dt)); // tighter clamp for smoothness
      const W = window.innerWidth, H = window.innerHeight;
      const subdt = dt / SUBSTEPS;

      for(let sub=0; sub<SUBSTEPS; sub++){
        // integrate
        for(const s of stars){ s.x += s.vx*subdt; s.y += s.vy*subdt; walls(s,W,H); }
        // collisions
        for(let i=0;i<stars.length;i++){
          for(let j=i+1;j<stars.length;j++) resolvePair(stars[i], stars[j]);
        }
      }

      // render
      for(const s of stars){
        s.rot += s.omega*dt;
        const rad = s.size/2;
        s.el.style.transform = `translate3d(${(s.x - rad)}px, ${(s.y - rad)}px,0) rotate(${s.rot}deg)`;
      }

      rafId = requestAnimationFrame(step);
    }

    function startLoop(){ if(!rafId){ lastT=0; rafId = requestAnimationFrame(step); }}
    function stopLoop(){ if(rafId){ cancelAnimationFrame(rafId); rafId=null; }}

    function initStars(keepRunning=false){
      spawnStars();
      if(keepRunning || starsEnabled) startLoop();
    }

    function setStars(on){
      starsEnabled = !!on; localStorage.setItem('stars', on?'on':'off');
      body.setAttribute('data-stars', on?'on':'off');
      document.getElementById('starsOn').classList.toggle('active', on);
      document.getElementById('starsOff').classList.toggle('active', !on);
      if(on){ initStars(true); } else { stopLoop(); starLayer.innerHTML=''; }
    }

    // controls
    starsOnBtn.addEventListener('click', ()=>setStars(true));
    starsOffBtn.addEventListener('click', ()=>setStars(false));

    // init from storage
    setStars(starsEnabled);

    // redraw on resize
    window.addEventListener('resize', ()=>{ if(starsEnabled) initStars(true); });
  </script>
</body>
</html>
